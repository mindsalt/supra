{% extends "base.html" %}

{% block title %}Projects{% endblock %}

{% block head_inc %}
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript">
$(document).ready(function() {
	
	//if no errors in form work slickbox magic on page load
	if ($('ul.errorlist').length == 0) {
	 	$('#add_new_box').hide();
		$('a#add_new_btn').click(function() {
			$('#add_new_box').toggle(400);
			return false;
		});
	}

	// ajax functions
	$.ajaxSetup ({
		cache: false
	});
	var ajax_load = "<img src='http://127.0.0.1:8000/site_media/img/ajax-loader.gif' alt='loading...' />";
	var loadUrl = "http://127.0.0.1:8000/project/edit/";

	$(".edit").click(function(){  
		var this_project = $(this).next().text();
		var to_replace = $(this).parent().css("class", "row_wrapper");
		to_replace.html(ajax_load).load(loadUrl, {projectId: this_project});  
	});
	
	/* accordion
	$('#accordion .header').click(function() {
		$(this).next().toggle('fast');
		return false;
	}).next().hide();
	*/
});


</script>

{% endblock %}

{% block content %}

<h1>Projects Page</h1>
<div class="object_add">
<h2><a id="add_new_btn" href="#">Add a new project</a></h2>

<div id="add_new_box">
{% if error_message %}<p><strong>{{ error_message }}</strong></p>{% endif %}

<form action="/project/view/" method="POST">
<table width="100%" border="0" cellspacing="0" cellpadding="0">
  <tr>
    <td><label for="id_client">Client:</label></td>
    <td colspan="3">{{ form.client }}</td>
  </tr>
  <tr>
    <td><label for="id_title">Project Title:</label></td>
    <td>{{ form.title }}</td>
    <td><label for="id_project_category">Category:</label></td>
    <td>{{ form.category }}</td>
  </tr>
  <tr>
    <td> <label for="id_est_time">Estimated Time</label></td>
    <td>{{ form.est_time }}</td>
    <td><label for="id_status">Status</label></td>
    <td>{{ form.status }}</td>
  </tr>
  <tr>
    <td>Notes</td>
    <td colspan="3">{{ form.notes }}</td>
  </tr>
  <tr>
    <td>&nbsp;</td>
    <td><input type="submit" value="Submit" /></td>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
  </tr>
</table>
</form>

</div><!-- end #add_new_box -->
</div><!-- end .object_add -->

<div class="objects_box">

<h2>All Projects</h2>

<table class="objects_table" width="100%" border="0" cellpadding="0" cellspacing="0">
	<thead>
		<tr>
			<th width="8%">Edit</th>
			<th width="10%">Project ID</th>
			<th width="25%">Title</th>
			<th width="20%">Client</th>
			<th width="10%">Est. Time</th>
			<th width="10%">Total Time</th>
			<th width="17%">Status</th>
		</tr>
	</thead>
</table>

{% if all_projects %}
<div id="accordion">
    {% for project in all_projects %}
    
    <!-- begin project -->
    <div class="row_wrapper">
        <div class="header">
        <table width="100%" border="0" cellpadding="0" cellspacing="0">
	        <tr>
	        	<td width="8%" class="edit">Edit</td>
	        	<td width="10%" class="projectId">{{ project.projectId }}</td>
	        	<td width="25%">{{ project.title }}</td> 
	        	<td width="20%">{{ project.client }}</td>
	        	<td width="10%">{{ project.est_time }}</td>
	        	<td width="10%">{{ project.total_time }}</td>
	        	<td width="17%">{{ project.status }}</td>
	        </tr>        
        </table>        
        </div><!-- end .header -->
        
        <div class="panel">
        <table width="100%">
	        <tr>
	        	<td width="83%">{{ project.notes }}</td>
	        	<td width="17%">{{ project.category }}</td>
			</tr>
		</table>
        </div><!-- end .panel -->
    </div><!-- end .row_wrapper -->  

    {% endfor %}
</div><!-- end #accordion -->
{% else %}
    <p>No projects are available.</p>
{% endif %}

</div><!-- end .objects_box -->
{% endblock %}



